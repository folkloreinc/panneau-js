webpackJsonp([483],{1656:function(module,exports){ace.define("ace/ext/chromevox",["require","exports","module","ace/editor","ace/config"],function(acequire,exports,module){var cvoxAce={};cvoxAce.SpeechProperty,cvoxAce.Cursor,cvoxAce.Token,cvoxAce.Annotation;var DELETED_PROP={punctuationEcho:"none",relativePitch:-.6},REPLACE_LIST=[{substr:";",newSubstr:" semicolon "},{substr:":",newSubstr:" colon "}],Command_SPEAK_ANNOT="annots",Command_SPEAK_ALL_ANNOTS="all_annots",Command_TOGGLE_LOCATION="toggle_location",Command_SPEAK_MODE="mode",Command_SPEAK_ROW_COL="row_col",Command_TOGGLE_DISPLACEMENT="toggle_displacement",Command_FOCUS_TEXT="focus_text";cvoxAce.editor=null;var lastCursor=null,annotTable={},shouldSpeakRowLocation=!1,shouldSpeakDisplacement=!1,changed=!1,vimState=null,keyCodeToShortcutMap={},cmdToShortcutMap={},isVimMode=function(){return"ace/keyboard/vim"===cvoxAce.editor.keyBinding.getKeyboardHandler().$id},getCurrentToken=function(cursor){return cvoxAce.editor.getSession().getTokenAt(cursor.row,cursor.column+1)},getCurrentLine=function(cursor){return cvoxAce.editor.getSession().getLine(cursor.row)},rules={constant:{prop:{rate:.8,pitch:.4,volume:.9}},entity:{prop:{rate:.8,pitch:.8,volume:.9}},keyword:{prop:{rate:.8,pitch:.3,volume:.9}},storage:{prop:{rate:.8,pitch:.7,volume:.9}},variable:{prop:{rate:.8,pitch:.8,volume:.9}},meta:{prop:{rate:1,pitch:.5,volume:.9},replace:[{substr:"</",newSubstr:" closing tag "},{substr:"/>",newSubstr:" close tag "},{substr:"<",newSubstr:" tag start "},{substr:">",newSubstr:" tag end "}]}},DEFAULT_RULE={prop:DEFAULT_RULE},expand=function(value,replaceRules){for(var newValue=value,i=0;i<replaceRules.length;i++){var replaceRule=replaceRules[i],regexp=new RegExp(replaceRule.substr,"g");newValue=newValue.replace(regexp,replaceRule.newSubstr)}return newValue},mergeTokens=function(tokens,start,end){var newToken={value:""};newToken.type=tokens[start].type;for(var j=start;j<end;j++)newToken.value+=tokens[j].value;return newToken},speakLine=function(row,queue){var tokens=cvoxAce.editor.getSession().getTokens(row);if(0===tokens.length||function(row){var line=cvoxAce.editor.getSession().getLine(row);return null!==/^\s*$/.exec(line)}(row))cvox.Api.playEarcon("EDITABLE_TEXT");else{var firstToken=(tokens=function(tokens){if(tokens.length<=1)return tokens;for(var newTokens=[],lastLikeIndex=0,i=1;i<tokens.length;i++){var lastLikeToken=tokens[lastLikeIndex],currToken=tokens[i];getTokenRule(lastLikeToken)!==getTokenRule(currToken)&&(newTokens.push(mergeTokens(tokens,lastLikeIndex,i)),lastLikeIndex=i)}return newTokens.push(mergeTokens(tokens,lastLikeIndex,tokens.length)),newTokens}(tokens))[0];tokens=tokens.filter(function(token){return token!==firstToken}),speakToken_(firstToken,queue),tokens.forEach(speakTokenQueue)}},speakTokenQueue=function(token){speakToken_(token,1)},getTokenRule=function(token){if(token&&token.type){var split=token.type.split(".");if(0!==split.length){var type=split[0],rule=rules[type];return rule||DEFAULT_RULE}}},speakToken_=function(token,queue){var rule=getTokenRule(token),value=expand(token.value,REPLACE_LIST);rule.replace&&(value=expand(value,rule.replace)),cvox.Api.speak(value,queue,rule.prop)},speakChar=function(cursor){var line=getCurrentLine(cursor);cvox.Api.speak(line[cursor.column],1)},speakDisplacement=function(lastCursor,currCursor){var displace=getCurrentLine(currCursor).substring(lastCursor.column,currCursor.column);displace=displace.replace(/ /g," space "),cvox.Api.speak(displace)},speakCharOrWordOrLine=function(lastCursor,currCursor){if(1!==Math.abs(lastCursor.column-currCursor.column)){var currLineLength=getCurrentLine(currCursor).length;if(0===currCursor.column||currCursor.column===currLineLength)return void speakLine(currCursor.row,0);if(function(cursor){var line=getCurrentLine(cursor),lineSuffix=line.substr(cursor.column-1);0===cursor.column&&(lineSuffix=" "+line);return null!==/^\W(\w+)/.exec(lineSuffix)}(currCursor))return cvox.Api.stop(),void speakTokenQueue(getCurrentToken(currCursor))}speakChar(currCursor)},onCursorChange=function(evt){if(changed)changed=!1;else{var currCursor=cvoxAce.editor.selection.getCursor();currCursor.row!==lastCursor.row?function(currCursor){annotTable[currCursor.row]&&cvox.Api.playEarcon("ALERT_NONMODAL"),shouldSpeakRowLocation?(cvox.Api.stop(),speakChar(currCursor),speakTokenQueue(getCurrentToken(currCursor)),speakLine(currCursor.row,1)):speakLine(currCursor.row,0)}(currCursor):function(lastCursor,currCursor){cvoxAce.editor.selection.isEmpty()?shouldSpeakDisplacement?speakDisplacement(lastCursor,currCursor):speakCharOrWordOrLine(lastCursor,currCursor):(speakDisplacement(lastCursor,currCursor),cvox.Api.speak("selected",1))}(lastCursor,currCursor),lastCursor=currCursor}},onSelectionChange=function(evt){cvoxAce.editor.selection.isEmpty()&&cvox.Api.speak("unselected")},onChange=function(delta){switch(delta.action){case"remove":cvox.Api.speak(delta.text,0,DELETED_PROP),changed=!0;break;case"insert":cvox.Api.speak(delta.text,0),changed=!0}},isNewAnnotation=function(annot){var row=annot.row,col=annot.column;return!annotTable[row]||!annotTable[row][col]},onAnnotationChange=function(evt){var annotations=cvoxAce.editor.getSession().getAnnotations();annotations.filter(isNewAnnotation).length>0&&cvox.Api.playEarcon("ALERT_NONMODAL"),function(annotations){annotTable={};for(var i=0;i<annotations.length;i++){var annotation=annotations[i],row=annotation.row,col=annotation.column;annotTable[row]||(annotTable[row]={}),annotTable[row][col]=annotation}}(annotations)},speakAnnotsByRow=function(row){var annot,annotText,annots=annotTable[row];for(var col in annots)annot=annots[col],annotText=void 0,annotText=(annotText=annot.type+" "+annot.text+" on "+rowColToString(annot.row,annot.column)).replace(";","semicolon"),cvox.Api.speak(annotText,1)},rowColToString=function(row,col){return"row "+(row+1)+" column "+(col+1)},onKeyDown=function(evt){if(evt.ctrlKey&&evt.shiftKey){var shortcut=keyCodeToShortcutMap[evt.keyCode];shortcut&&shortcut.func()}},onChangeStatus=function(evt,editor){if(isVimMode()){var state=editor.keyBinding.$data.state;if(state!==vimState){switch(state){case"insertMode":cvox.Api.playEarcon("ALERT_MODAL"),cvox.Api.setKeyEcho(!0);break;case"start":cvox.Api.playEarcon("ALERT_MODAL"),cvox.Api.setKeyEcho(!1)}vimState=state}}},contextMenuHandler=function(evt){var cmd=evt.detail.customCommand,shortcut=cmdToShortcutMap[cmd];shortcut&&(shortcut.func(),cvoxAce.editor.focus())},initContextMenu=function(){var ACTIONS=SHORTCUTS.map(function(shortcut){return{desc:shortcut.desc+(keyCode=shortcut.keyCode,"CONTROL + SHIFT "+String.fromCharCode(keyCode)),cmd:shortcut.cmd};var keyCode}),body=document.querySelector("body");body.setAttribute("contextMenuActions",JSON.stringify(ACTIONS)),body.addEventListener("ATCustomEvent",contextMenuHandler,!0)},onFindSearchbox=function(evt){evt.match?speakLine(lastCursor.row,0):cvox.Api.playEarcon("INVALID_KEYPRESS")},SHORTCUTS=[{keyCode:49,func:function(){speakAnnotsByRow(lastCursor.row)},cmd:Command_SPEAK_ANNOT,desc:"Speak annotations on line"},{keyCode:50,func:function(){for(var row in annotTable)speakAnnotsByRow(row)},cmd:Command_SPEAK_ALL_ANNOTS,desc:"Speak all annotations"},{keyCode:51,func:function(){if(isVimMode())switch(cvoxAce.editor.keyBinding.$data.state){case"insertMode":cvox.Api.speak("Insert mode");break;case"start":cvox.Api.speak("Command mode")}},cmd:Command_SPEAK_MODE,desc:"Speak Vim mode"},{keyCode:52,func:function(){(shouldSpeakRowLocation=!shouldSpeakRowLocation)?cvox.Api.speak("Speak location on row change enabled."):cvox.Api.speak("Speak location on row change disabled.")},cmd:Command_TOGGLE_LOCATION,desc:"Toggle speak row location"},{keyCode:53,func:function(){cvox.Api.speak(rowColToString(lastCursor.row,lastCursor.column))},cmd:Command_SPEAK_ROW_COL,desc:"Speak row and column"},{keyCode:54,func:function(){(shouldSpeakDisplacement=!shouldSpeakDisplacement)?cvox.Api.speak("Speak displacement on column changes."):cvox.Api.speak("Speak current character or word on column changes.")},cmd:Command_TOGGLE_DISPLACEMENT,desc:"Toggle speak displacement"},{keyCode:55,func:function(){cvoxAce.editor.focus()},cmd:Command_FOCUS_TEXT,desc:"Focus text"}],onFocus=function(_,editor){cvoxAce.editor=editor,editor.getSession().selection.on("changeCursor",onCursorChange),editor.getSession().selection.on("changeSelection",onSelectionChange),editor.getSession().on("change",onChange),editor.getSession().on("changeAnnotation",onAnnotationChange),editor.on("changeStatus",onChangeStatus),editor.on("findSearchBox",onFindSearchbox),editor.container.addEventListener("keydown",onKeyDown),lastCursor=editor.selection.getCursor()},init=function(editor){onFocus(0,editor),SHORTCUTS.forEach(function(shortcut){keyCodeToShortcutMap[shortcut.keyCode]=shortcut,cmdToShortcutMap[shortcut.cmd]=shortcut}),editor.on("focus",onFocus),isVimMode()&&cvox.Api.setKeyEcho(!1),initContextMenu()};var tries=0,MAX_TRIES=15;function watchForCvoxLoad(editor){if(function cvoxApiExists(){return"undefined"!=typeof cvox&&cvox&&cvox.Api}())init(editor);else{if(++tries>=MAX_TRIES)return;window.setTimeout(watchForCvoxLoad,500,editor)}}var Editor=acequire("../editor").Editor;acequire("../config").defineOptions(Editor.prototype,"editor",{enableChromevoxEnhancements:{set:function(val){val&&watchForCvoxLoad(this)},value:!0}})}),ace.acequire(["ace/ext/chromevox"],function(){})}});